<!DOCTYPE html>
<html>
    <head>
        <title>Place searches</title>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <meta charset="utf-8">
        <style>
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
                height: 100%;
            }
            
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height : 100%;
                margin : 0;
                padding: 0;
            }
        </style>
        <script>
            var restaurants = [], breweries = [], trails = [];
            var arrayType; 

            var map;
            var infowindow;
            var service;

            function initMap() {
                var austin = {lat: 30.307182, lng: -97.755996};

                map = new google.maps.Map(document.getElementById('map'), {
                    center: austin,
                    zoom  : 12
                });

                infowindow = new google.maps.InfoWindow();
                service    = new google.maps.places.PlacesService(map);

                arrayType = "restaurants";
                service.nearbySearch({
                    keyword : "bbq",
                    location: austin,
                    radius  : 16000,
                    type    : ["restaurant"]

                }, getPlaceID);
            }

            function getPlaceID(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    var i = 0;

                    var intervalID = setInterval(function() {
                        service.getDetails({
                                // Get the ID
                                "placeId": results[i].place_id
                        
                            }, getPlaceDetails);

    //                        createMarker(results[i]);
                        i++;

                        if (i === results.length) {
                            clearInterval(intervalID);
                        }

                    }, 400);
                }
            }

            function getPlaceDetails(place, status) {
                // console.log(this.arrayType);
                // console.log("status: " + status + ", place: " + place);

                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    console.log(place);
                    var formatted_address = place.formatted_address;

                    var temp = formatted_address.split(",");

                    var street, city, state, zipcode;

                        street = temp[0].trim();
                        city = temp[1].trim();
                        state = temp[2].trim().substring(0,2);
                        zipcode = temp[2].trim().substring(3);

                    var location =  {
                                     "street": street,
                                     "city": city,
                                     "state": state,
                                     "zipcode": zipcode
                                    }

// object for info on each place 

                    var photoUrl = typeof place.photos !== 'undefined'
                        ? place.photos[0].getUrl({'maxWidth':300, 'maxHeight': 300})
                        : '' ;

                    var placeData = {"name"    : place.name,
                                     "location": location,
                                     "geometry": place.geometry,
                                     "phone"   : place.formatted_phone_number,
                                     "hours"   : place.opening_hours.periods,
                                     "website" : place.website,
                                     "image"   : photoUrl,
                                     "rating"  : place.rating,
                                     "type"    : place.types[0]
                                     }

                    createMarker(place);
                    restaurants.push(placeData)
                    // console.log(placeData);

                }
            }

            function createMarker(place) {
                var marker = new google.maps.Marker({
                    map     : map,
                    position: place.geometry.location
                });

                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.setContent('<div><strong>' + place.name + '</strong><br>' +
                                          'Place ID: ' + place.place_id + '<br>' + place.formatted_address + '</div>');
                    infowindow.open(map, this);
                });
            }
        </script>
      </head>
      <body>
        <div id="map"></div>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5UBuB1NoQsps2oc6EdyNhrLGbYY_FZMQ&libraries=places&callback=initMap" async defer></script>
      </body>
</html>